function doPost(e) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  var action = e.parameter.action;
  
  if (action === 'addRecord') {
    var id = e.parameter.id;
    var rank = e.parameter.rank;
    var name = e.parameter.name;
    var policeStation = e.parameter.policeStation;
    var sector = e.parameter.sector;
    var shift = e.parameter.shift;
    var timestamp = e.parameter.timestamp;
    var lat = e.parameter.lat;
    var lng = e.parameter.lng;
    var photo = e.parameter.photo;
    
    sheet.appendRow([id, rank, name, policeStation, sector, shift, timestamp, lat, lng, photo]);
    
    return ContentService.createTextOutput(JSON.stringify({success: true})).setMimeType(ContentService.MimeType.JSON);
  }
  
  return ContentService.createTextOutput(JSON.stringify({success: false, error: 'Unknown action'})).setMimeType(ContentService.MimeType.JSON);
}

function doGet(e) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  var data = sheet.getDataRange().getValues();
  var headers = data[0];
  var jsonData = [];
  
  for (var i = 1; i < data.length; i++) {
    var row = {};
    for (var j = 0; j < headers.length; j++) {
      row[headers[j]] = data[i][j];
    }
    jsonData.push(row);
  }
  
  return ContentService.createTextOutput(JSON.stringify(jsonData)).setMimeType(ContentService.MimeType.JSON);
}
